# 提案：添加拳手预约拳馆功能

## 背景

当前平台支持拳手和拳馆档案管理，但缺乏实战训练场地预约功能。拳馆需要发布可用时间段供拳手预约，拳手需要能够查看和预约这些时间段。

## 目标

实现完整的拳馆场地预约系统，包括：
1. 拳馆发布未来一周内的可用时间段
2. 拳手查看并预约可用的场地时间段
3. 预约状态管理和取消机制
4. 拳馆和拳手的消息通知

## 核心功能

### 拳馆侧
- 发布可用时间段：日期、开始时间、结束时间、最大人数
- 查看已发布的时间段及其预约状态
- 无预约时可修改/撤销时间段
- 有预约后不允许修改/撤销
- 查看每个时间段的预约拳手列表

### 拳手侧
- 浏览未来一周内所有拳馆发布的可用时间段
- 按拳馆、日期、时间段筛选
- 预约可用时间段（在人数限制内）
- 取消预约（时间段结束前半小时）
- 查看特定时间段的已预约拳手

### 消息通知
- 拳手预约时：拳馆收到通知
- 拳手取消预约时：拳馆和同时间段其他拳手收到通知
- 使用微信订阅消息 + 应用内消息

## 约束条件

1. 拳馆只能发布未来一周内的时间段
2. 拳馆只能修改无预约的时间段
3. 拳手只能在时间段结束前半小时取消预约
4. 每个时间段有最大人数限制
5. 使用微信云开发原生能力（数据库事务、云函数）

## 影响范围

### 新增数据集合
- `gym_slots`: 拳馆场地时间段
- `slot_bookings`: 预约记录

### 新增云函数
- `gym-slot-publish`: 发布时间段
- `gym-slot-list`: 查看已发布时间段
- `gym-slot-update`: 修改时间段
- `gym-slot-delete`: 撤销时间段
- `slot-list`: 拳手浏览可用时间段
- `slot-book`: 预约时间段
- `slot-cancel`: 取消预约
- `slot-bookings`: 查看时间段预约列表

### 新增页面
- 拳馆：场地管理页面、发布时间段页面
- 拳手：可预约时间段列表页面、时间段详情页面

### 修改云函数
- `gym/get`: 返回拳馆档案时包含场地信息统计
- `common/stats`: 返回场地统计数据

## 验收标准

1. 拳馆可以成功发布未来一周内的可用时间段
2. 拳手可以查看并预约符合条件的时间段
3. 达到人数上限后无法继续预约
4. 无预约时拳馆可以修改/撤销时间段
5. 有预约后时间段不可修改/撤销
6. 拳手可在结束前半小时取消预约
7. 拳馆和拳手能正确收到消息通知
8. 所有操作使用数据库事务保证一致性
