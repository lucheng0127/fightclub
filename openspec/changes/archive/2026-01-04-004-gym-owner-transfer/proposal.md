# 提案: 拳馆负责人更换功能

## 元信息

- **变更ID**: 004-gym-owner-transfer
- **标题**: 新增拳馆负责人更换功能
- **状态**: proposed
- **创建时间**: 2025-01-04
- **负责人**: TBD

## 问题陈述

当前系统中,拳馆一旦创建后,无法更换负责人(即拥有该拳馆的用户)。这导致以下问题:

1. **业务灵活性受限**: 当拳馆实际经营者变更时,系统无法支持负责人的合法转移
2. **账号管理困难**: 原负责人可能不再经营拳馆,但系统无法将拳馆转移给新的负责人
3. **用户体验问题**: 原负责人无法放弃拳馆角色,新负责人也无法接管现有拳馆档案

## 解决方案概述

允许拳馆当前负责人从平台用户列表中选择一名用户,将拳馆转移给该用户。转移完成后:

- 原负责人的 `has_gym_profile` 标志被清除,不再拥有拳馆角色
- 新负责人的 `has_gym_profile` 标志被设置,成为拳馆所有者
- 拳馆的 `user_id` 字段更新为新负责人的 OpenID
- 拳馆的审核状态和其他信息保持不变
- 原负责人和新负责人都会收到转移成功的通知

## 核心功能点

1. **用户选择**: 从已登录平台用户列表中选择接收人(使用现有的 `user-list` 云函数)
2. **权限验证**: 只有当前拳馆负责人可发起转移
3. **事务安全**: 使用数据库事务确保转移操作的原子性
4. **状态检查**: 转移前检查拳馆状态(已审核通过的拳馆方可转移)
5. **通知机制**: 转移完成后通知原负责人和新负责人
6. **操作日志**: 记录转移历史,包括转移时间、原负责人、新负责人

## 影响范围

### 新增功能

- 云函数: `gym-transfer` (执行拳馆转移)
- 前端页面: `pages/gym/owner-transfer/` (拳馆负责人转移页面)
- 数据库集合: `gym_transfers` (记录转移历史)

### 修改内容

- `boxing-platform` 规格新增"拳馆负责人转移"需求

### 不受影响的功能

- 拳馆档案管理(创建、编辑、查看)
- 拳馆审核流程
- 拳馆预约功能
- 拳手相关功能

## 成功指标

- 负责人可以成功将拳馆转移给其他用户
- 转移操作使用事务保证数据一致性
- OpenID 不暴露给前端
- 原负责人和新负责人收到通知

## 风险与限制

1. **误操作风险**: 用户可能误将拳馆转移给错误的人
   - 缓解措施: 添加二次确认对话框,显示接收人昵称
2. **并发转移**: 多个转移操作同时进行可能导致数据不一致
   - 缓解措施: 使用数据库事务和乐观锁
3. **接收人已有拳馆**: 接收人已经拥有拳馆档案
   - 缓解措施: 转移前验证,拒绝转移并提示
