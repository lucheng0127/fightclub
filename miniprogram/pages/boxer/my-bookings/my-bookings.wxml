<!-- æˆ‘çš„é¢„çº¦é¡µé¢ -->
<view class="container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="nav-bar" style="padding-top: {{statusBarHeight}}px; height: {{navBarHeight}}px;">
    <view class="nav-bar-content">
      <text class="nav-bar-back" bindtap="onBack">â†</text>
      <text class="nav-bar-title">æˆ‘çš„é¢„çº¦</text>
    </view>
  </view>

  <!-- çŠ¶æ€åˆ‡æ¢ -->
  <view class="status-tabs">
    <view
      class="status-tab {{currentStatus === 'active' ? 'active' : ''}}"
      bindtap="onStatusChange"
      data-status="active"
    >
      <text>è¿›è¡Œä¸­ ({{activeCount}})</text>
    </view>
    <view
      class="status-tab {{currentStatus === 'all' ? 'active' : ''}}"
      bindtap="onStatusChange"
      data-status="all"
    >
      <text>å…¨éƒ¨ ({{totalCount}})</text>
    </view>
    <view
      class="status-tab {{currentStatus === 'cancelled' ? 'active' : ''}}"
      bindtap="onStatusChange"
      data-status="cancelled"
    >
      <text>å·²å–æ¶ˆ ({{cancelledCount}})</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading && list.length === 0}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:if="{{!loading && list.length === 0}}">
    <text class="empty-icon">ğŸ“…</text>
    <text class="empty-text">{{currentStatus === 'active' ? 'æš‚æ— è¿›è¡Œä¸­çš„é¢„çº¦' : 'æš‚æ— é¢„çº¦è®°å½•'}}</text>
    <button class="empty-btn" bindtap="goToSlotList" wx:if="{{currentStatus === 'active'}}">
      å»é¢„çº¦åœºåœ°
    </button>
  </view>

  <!-- é¢„çº¦åˆ—è¡¨ -->
  <view class="list" wx:if="{{list.length > 0}}" style="padding-top: {{navBarHeight + 100}}rpx;">
    <view class="card booking-card" wx:for="{{list}}" wx:key="booking_id">
      <!-- æ‹³é¦†ä¿¡æ¯ -->
      <view class="gym-info" bindtap="onGymTap" data-id="{{item.gym.gym_id}}">
        <view class="gym-name">{{item.gym.name}}</view>
        <view class="gym-address">
          <text class="address-icon">ğŸ“</text>
          <text>{{item.gym.city}} {{item.gym.address}}</text>
        </view>
      </view>

      <!-- æ—¶é—´æ®µä¿¡æ¯ -->
      <view class="slot-info">
        <view class="slot-date">
          <text class="date-icon">ğŸ“…</text>
          <text class="date-text">{{item.slot.date}}</text>
          <view class="status-badge {{item.status === 'active' ? 'active' : 'cancelled'}}">
            <text>{{item.status === 'active' ? 'è¿›è¡Œä¸­' : 'å·²å–æ¶ˆ'}}</text>
          </view>
        </view>
        <view class="slot-time">
          <text class="time-icon">â°</text>
          <text class="time-text">{{item.slot.start_time}} - {{item.slot.end_time}}</text>
        </view>
      </view>

      <!-- å–å€’è®¡æ—¶ -->
      <view class="deadline" wx:if="{{item.status === 'active' && item.minutes_until_deadline !== null}}">
        <text class="deadline-icon">â³</text>
        <text class="deadline-text" wx:if="{{item.minutes_until_deadline > 0}}">
          {{item.minutes_until_deadline}}åˆ†é’Ÿåå¯å–æ¶ˆ
        </text>
        <text class="deadline-text deadline-expired" wx:else>
          ä¸å¯å–æ¶ˆï¼ˆå·²è¿‡æˆªæ­¢æ—¶é—´ï¼‰
        </text>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="actions">
        <button
          class="action-btn detail-btn"
          bindtap="onViewDetail"
          data-id="{{item.slot_id}}"
        >
          æŸ¥çœ‹è¯¦æƒ…
        </button>

        <button
          class="action-btn cancel-btn"
          bindtap="onCancelBooking"
          data-id="{{item.booking_id}}"
          data-index="{{index}}"
          disabled="{{item.cancelling || !item.can_cancel}}"
          wx:if="{{item.status === 'active'}}"
        >
          {{item.cancelling ? 'å–æ¶ˆä¸­...' : (item.can_cancel ? 'å–æ¶ˆé¢„çº¦' : 'ä¸å¯å–æ¶ˆ')}}
        </button>
      </view>
    </view>
  </view>
</view>
