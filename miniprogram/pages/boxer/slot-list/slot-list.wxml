<!-- å¯é¢„çº¦åœºåœ°åˆ—è¡¨é¡µ -->
<view class="container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="nav-bar" style="padding-top: {{statusBarHeight}}px; height: {{navBarHeight}}px;">
    <view class="nav-bar-content">
      <text class="nav-bar-back" bindtap="onBack">â†</text>
      <text class="nav-bar-title">å¯é¢„çº¦åœºåœ°</text>
    </view>
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filters">
    <!-- åŸå¸‚ç­›é€‰ -->
    <view class="filter-chip" bindtap="onShowCityPicker">
      <text class="filter-chip-text">{{filters.city || 'åŸå¸‚'}}</text>
      <text class="filter-chip-icon">â–¼</text>
    </view>

    <!-- æ¸…ç©ºç­›é€‰ -->
    <view class="filter-chip filter-chip-action" bindtap="onClearFilters" wx:if="{{hasFilters}}">
      <text class="filter-chip-text">æ¸…ç©º</text>
    </view>
  </view>

  <!-- åŸå¸‚é€‰æ‹©å¼¹çª— -->
  <view class="city-picker-modal" wx:if="{{showCityPicker}}">
    <view class="city-picker-mask" bindtap="onHideCityPicker"></view>
    <view class="city-picker-content">
      <view class="city-picker-header">
        <text class="city-picker-title">é€‰æ‹©åŸå¸‚</text>
        <text class="city-picker-close" bindtap="onHideCityPicker">âœ•</text>
      </view>
      <view class="city-picker-body">
        <picker-view
          class="city-picker-view"
          indicator-style="height: 50px;"
          value="{{cityPickerValue}}"
          bindchange="onCityPickerChange"
        >
          <picker-view-column>
            <view wx:for="{{provinces}}" wx:key="*this">{{item}}</view>
          </picker-view-column>
          <picker-view-column>
            <view wx:for="{{cities}}" wx:key="*this">{{item}}</view>
          </picker-view-column>
        </picker-view>
      </view>
      <view class="city-picker-footer">
        <button class="city-picker-btn city-picker-btn-cancel" bindtap="onHideCityPicker">å–æ¶ˆ</button>
        <button class="city-picker-btn city-picker-btn-confirm" bindtap="onConfirmCity">ç¡®å®š</button>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading && list.length === 0}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:if="{{!loading && list.length === 0}}">
    <text class="empty-icon">ğŸ¥Š</text>
    <text class="empty-text">{{hasFilters ? 'æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„åœºåœ°' : 'æš‚æ— å¯é¢„çº¦åœºåœ°'}}</text>
  </view>

  <!-- åœºåœ°åˆ—è¡¨ -->
  <view class="list" wx:if="{{list.length > 0}}" style="padding-top: {{navBarHeight + 140}}rpx;">
    <view
      class="card slot-card"
      wx:for="{{list}}"
      wx:key="slot_id"
      bindtap="onCardTap"
      data-id="{{item.slot_id}}"
    >
      <!-- æ‹³é¦†ä¿¡æ¯ -->
      <view class="gym-info">
        <view class="gym-name">{{item.gym.name}}</view>
        <view class="gym-address">
          <text class="address-icon">ğŸ“</text>
          <text>{{item.gym.city}} {{item.gym.address}}</text>
        </view>
      </view>

      <!-- æ—¶é—´æ®µä¿¡æ¯ -->
      <view class="slot-info">
        <view class="slot-date">
          <text class="date-icon">ğŸ“…</text>
          <text class="date-text">{{item.date}}</text>
        </view>
        <view class="slot-time">
          <text class="time-icon">â°</text>
          <text class="time-text">{{item.start_time}} - {{item.end_time}}</text>
        </view>
      </view>

      <!-- é¢„çº¦çŠ¶æ€ -->
      <view class="booking-status">
        <view class="capacity {{item.available_spots === 0 ? 'full' : ''}}">
          <text class="capacity-icon">ğŸ‘¥</text>
          <text>{{item.current_bookings}}/{{item.max_boxers}}</text>
          <text wx:if="{{item.available_spots > 0}}"> (ä½™{{item.available_spots}})</text>
          <text wx:else> (å·²æ»¡)</text>
        </view>

        <view class="booked-badge" wx:if="{{item.is_booked}}">
          <text class="booked-icon">âœ“</text>
          <text>å·²é¢„çº¦</text>
        </view>
      </view>
    </view>
  </view>
</view>
