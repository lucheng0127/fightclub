<!-- 拳馆档案创建页 -->
<view class="container">
  <view class="header">
    <text class="title">创建拳馆档案</text>
    <text class="subtitle">请填写拳馆信息</text>
  </view>

  <form class="form" bindsubmit="onSubmit">
    <!-- 拳馆名称 (必填) -->
    <view class="form-item">
      <text class="label">拳馆名称 *</text>
      <input
        class="input"
        name="name"
        placeholder="请输入拳馆名称"
        value="{{formData.name}}"
        bindinput="onNameInput"
        maxlength="50"
      />
    </view>

    <!-- 地址 (必填) -->
    <view class="form-item">
      <text class="label">地址 *</text>
      <view class="location-section">
        <input
          class="input location-input"
          name="address"
          placeholder="请输入详细地址"
          value="{{formData.address}}"
          bindinput="onAddressInput"
        />
        <button class="location-btn" type="default" bindtap="onChooseLocation">
          选择位置
        </button>
      </view>
    </view>

    <!-- 位置信息 (必填, 自动获取) -->
    <view class="form-item" wx:if="{{formData.location}}">
      <text class="label">已选择位置</text>
      <text class="location-info">
        纬度: {{formData.location.latitude.toFixed(6)}},
        经度: {{formData.location.longitude.toFixed(6)}}
      </text>
    </view>

    <!-- 城市 (可选) -->
    <view class="form-item">
      <text class="label">城市</text>
      <view class="picker-input" bindtap="onShowCityPicker">
        <text class="picker-input-text {{formData.cityDisplay ? '' : 'placeholder'}}">
          {{formData.cityDisplay || '请选择所在城市'}}
        </text>
        <text class="picker-input-icon">▼</text>
      </view>
    </view>

    <!-- 城市选择弹窗 -->
    <view class="city-picker-modal" wx:if="{{showCityPicker}}">
      <view class="city-picker-mask" bindtap="onHideCityPicker"></view>
      <view class="city-picker-content">
        <view class="city-picker-header">
          <text class="city-picker-title">选择城市</text>
          <text class="city-picker-close" bindtap="onHideCityPicker">✕</text>
        </view>
        <view class="city-picker-body">
          <picker-view
            class="city-picker-view"
            indicator-style="height: 50px;"
            value="{{cityPickerValue}}"
            bindchange="onCityPickerChange"
          >
            <picker-view-column>
              <view wx:for="{{provinces}}" wx:key="*this">{{item}}</view>
            </picker-view-column>
            <picker-view-column>
              <view wx:for="{{cities}}" wx:key="*this">{{item}}</view>
            </picker-view-column>
          </picker-view>
        </view>
        <view class="city-picker-footer">
          <button class="city-picker-btn city-picker-btn-cancel" bindtap="onHideCityPicker">取消</button>
          <button class="city-picker-btn city-picker-btn-confirm" bindtap="onConfirmCity">确定</button>
        </view>
      </view>
    </view>

    <!-- 联系电话 (必填) -->
    <view class="form-item">
      <text class="label">联系电话 *</text>
      <input
        class="input"
        type="number"
        name="phone"
        placeholder="请输入联系电话"
        value="{{formData.phone}}"
        bindinput="onPhoneInput"
        maxlength="11"
      />
    </view>

    <!-- 拳馆图标 (可选) -->
    <view class="form-item">
      <text class="label">拳馆图标</text>
      <view class="upload-section">
        <image
          class="icon-preview"
          src="{{formData.icon_url || '/images/gym-placeholder.png'}}"
          mode="aspectFill"
        />
        <button class="upload-btn" type="default" bindtap="onChooseImage">
          {{formData.icon_url ? '重新选择' : '选择图片'}}
        </button>
      </view>
    </view>

    <!-- 提交按钮 -->
    <view class="submit-section">
      <button
        class="submit-btn {{isFormValid ? '' : 'disabled'}}"
        formType="submit"
        disabled="{{!isFormValid}}"
        loading="{{submitting}}"
      >
        创建档案
      </button>
    </view>
  </form>
</view>
